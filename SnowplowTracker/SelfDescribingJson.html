<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SnowplowTracker::SelfDescribingJson
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "SnowplowTracker::SelfDescribingJson";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../SnowplowTracker.html" title="SnowplowTracker (module)">SnowplowTracker</a></span></span>
     &raquo; 
    <span class="title">SelfDescribingJson</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SnowplowTracker::SelfDescribingJson
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">SnowplowTracker::SelfDescribingJson</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/snowplow-tracker/self_describing_json.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Creates the self-describing JSONs necessary for sending context or
self-describing events. These are a specific kind of <a href="http://json-schema.org/">JSON
schema</a>.</p>

<p>A unique schema can be designed for each type of event or entity (for event
context) that you want to track. This allows you to track the specific
things that are important to you, in a way that is defined by you.</p>

<p>A self-describing JSON has two keys, <code>schema</code> and <code>data</code>. The <code>schema</code> value
should point to a valid self-describing JSON schema. They are called
self-describing because the schema will specify the fields allowed in the
<code>data</code> value. After events have been collected by the event collector, they
are validated to ensure that the self-describing JSONs are correct. Mistakes
(e.g. extra fields, or incorrect types) will result in events being
processed as Bad Events.</p>

<p>A SelfDescribingJson is initialized with <code>schema</code> and <code>data</code> as separate
arguments. These parameters are combined into a complete self-describing
JSON during the event creation, which is stringified and sent as part of the
event. By default, they will be sent base64-encoded. This can be changed on
<span class='object_link'><a href="Tracker.html" title="SnowplowTracker::Tracker (class)">Tracker</a></span> initialization.</p>

<p>The <code>data</code> argument must be a flat hash of key-value pairs. Either strings
or symbols are accepted as keys. The <code>schema</code> argument must be a correctly
formatted schema ID.</p>

<p>When used to send event context data, stringified self-describing JSONs will
be sent in the raw event as <code>cx</code>, or <code>co</code> if not encoded. Whether encoded or
not, these strings will be converted back to JSON within the <code>contexts</code>
parameter of the processed event. All the event context is contained within
this one parameter, even if multiple context entities were sent.</p>

<p>Self-describing JSONs in self-describing events are sent in a similar
manner. They are sent as <code>ue_px</code> in the raw event, or <code>ue_pr</code> if not
encoded. This is processed into the <code>unstruct_event</code> parameter of the
finished event.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='comment'># This example schema describes an ad_click event.
</span><span class='comment'># It defines a single property for that event type, a &quot;bannerId&quot;.
</span>
<span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$schema</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://json-schema.org/schema#</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>self</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>vendor</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>com.snowplowanalytics</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ad_click</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>format</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>jsonschema</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1-0-0</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>object</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>properties</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bannerId</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>string</span><span class='tstring_end'>&quot;</span></span>
      <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>required</span><span class='label_end'>&quot;:</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bannerId</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>additionalProperties</span><span class='label_end'>&quot;:</span> <span class='kw'>false</span>
<span class='rbrace'>}</span>

<span class='comment'># Creating the SelfDescribingJson
</span><span class='id identifier rubyid_schema_name'>schema_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iglu:com.snowplowanalytics/ad_click/jsonschema/1-0-0</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_event_data'>event_data</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>bannerId:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>4acd518feb82</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='const'><span class='object_link'><a href="../SnowplowTracker.html" title="SnowplowTracker (module)">SnowplowTracker</a></span></span><span class='op'>::</span><span class='const'>SelfDescribingJson</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="SnowplowTracker::SelfDescribingJson#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_schema_name'>schema_name</span><span class='comma'>,</span> <span class='id identifier rubyid_event_data'>event_data</span><span class='rparen'>)</span>

<span class='comment'># The self-describing JSON that will be sent (stringified) with the event
</span><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>schema</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>iglu:com.snowplowanalytics/ad_click/jsonschema/1-0-0</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='label_end'>&quot;:</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bannerId</span><span class='label_end'>&quot;:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>4acd518feb82</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span></code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://docs.snowplowanalytics.com/docs/understanding-tracking-design/understanding-schemas-and-validation/" target="_parent" title="introduction to Snowplow schemas">introduction to Snowplow schemas</a></li>
    
      <li><a href="https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/iglu/" target="_parent" title="schema management using Iglu">schema management using Iglu</a></li>
    
      <li><a href="https://docs.snowplowanalytics.com/docs/collecting-data/collecting-from-own-applications/snowplow-tracker-protocol" target="_parent" title="the Snowplow Tracker Protocol">the Snowplow Tracker Protocol</a></li>
    
  </ul>

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(schema, data)  &#x21d2; SelfDescribingJson </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of SelfDescribingJson.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(schema, data)  &#x21d2; <tt><span class='object_link'><a href="" title="SnowplowTracker::SelfDescribingJson (class)">SelfDescribingJson</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of SelfDescribingJson.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>schema</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>schema identifier</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a flat hash that matches the description in the schema</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/snowplow-tracker/self_describing_json.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_schema'>schema</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='ivar'>@schema</span> <span class='op'>=</span> <span class='id identifier rubyid_schema'>schema</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


</div>

      <div id="footer">
  Generated on Fri Oct 29 20:03:37 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.6.8).
</div>

    </div>
  </body>
</html>